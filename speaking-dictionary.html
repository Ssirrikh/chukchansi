<!DOCTYPE html>
<html>

<head>
	<meta charset = 'utf-8'>
	<title>Chukchansi-English Speaking Dictionary</title>
	<style>
		* {
			margin: 0px;
			padding: 0px;
			font-family: 'Times New Roman';
		}	
		body {
			background-color: #000000;
			overflow: hidden;
		}
		
		/* header bar */
		#navBar {
			background-color: #461220;

			box-sizing: border-box;
			position: sticky;
			padding: 10px;
			top: 0px;
			width: 100%;
			height: 50px;
			z-index: 2; /* make sure hanging tabs are on top of other content */

			border-bottom: 1px solid #ffffff;
		}
		#pageTitle {
			color: #ffdab3;

			position: absolute;
			/*margin: 10px;*/
			left: 50%;

			transform: translate(-50%, 0%);

			font-size: 25px;
		}

		/* left panel search box */
		#searchPanel {
			background-color: #f2e3d3;

			position: absolute;
			top: 50px;
			width: 25%;
			height: 46px;

			border-bottom: 4px solid #4f3a09;

			overflow: visible;
		}
		#searchBar {
			color: #75544b;
			background-color: #ffffff;

			box-sizing: border-box;
			margin: 8px;
			padding: 0px 50px 0px 15px;
			width: calc(25vw - 16px);
			height: 30px;

			border: 1px solid #bfa07e;
			border-radius: 30px;

			font-size: 20px;
		}
		#searchBar:focus {
			margin: 7px;
			border: 2px solid #75544b;
			outline: none;
		}
		#searchClearButton {
			cursor: pointer;

			position: absolute;
			top: calc(50%);
			right: 10px;
			width: 24px;
			height: 24px;
			transform: translate(0%, -50%);

			border-radius: 50%;
		}
		.searchClearCross {
			background-color: #826545;

			display: inline-block;
			position: absolute;
			top: 50%;
			right: 50%;
			width: 2px;
			height: 18px;
			/*transform: translate(-50%, -50%);*/
		}
		#searchHistoryButton {
			cursor: pointer;

			position: absolute;
			top: calc(50%);
			right: calc(10px + 24px);
			width: 24px;
			height: 24px;
			transform: translate(0%, -50%);

			border-radius: 50%;
		}
		#searchHistoryArrow {
			position: absolute;
			padding: 4px;
			left: 50%;

			border: solid #826545;
			border-width: 0 3px 3px 0;

			transition: all 0.25s ease;
		}
		.arrowDown {
			top: calc(50% - 2px);
			transform: translate(-50%,-50%) rotate(45deg);
		}
		.arrowUp {
			top: calc(50% + 3px);
			transform: translate(-50%,-50%) rotate(225deg);
		}

		/* language toggle */
		#hangingTab {
			background-color: #f2e3d3;

			position: absolute;
			top: 50px;
			left: calc(100% - 30px);
			width: 100px;
			height: 30px;
			transform: translate(-100%, 0%);
			
			border: 3px solid;
			border-top: none;
			border-color: #4f3a09;
			border-radius: 0px 0px 15px 15px;
		}
		#langToggleTitle {
			color: #4f3a09;

			position: absolute;
			top: calc(50% - 1px);
			left: 29px;
			transform: translate(-50%, -50%);

			font-size: 20px;
		}
		#langToggle {
			cursor: pointer;
			
			background-color: #ad8e6c;

			position: absolute;
			top: 50%;
			left: calc(100% - 7px);
			width: 30px;
			height: 16px;
			transform: translate(-100%, -50%);
			
			border: 3px solid;
			border-color: #4f3a09;
			border-radius: 15px;
		}
		#langToggleSwitch {
			background-color: #4f3a09;

			position: absolute;
			top: 50%;
			left: 1px;
			width: 18px;
			height: 14px;
			transform: translate(0%, -50%);

			border-radius: 7px;
		}

		/* left panel search results */
		#resultPanel {
			background-color: #bfa07e;
			/*background-color: #f2e3d3;*/

			box-sizing: border-box;
			position: absolute;
			/*padding: 1px;*/
			top: 100px;
			width: 25%;
			height: calc(100% - 100px);

			overflow: scroll;
			-ms-overflow-style: none;  /* Hide scrollbar for IE and Edge */
			scrollbar-width: none;  /* Hide scrollbar for Firefox */
		}
		#resultPanel::-webkit-scrollbar { display: none; } /* Hide scrollbar for Chrome, Safari and Opera */
		.searchResult {
			cursor: pointer;
			
			color: #4f3a09;
			background-color: #f2e3d3;

			margin: 4px;
			padding: 2px 10px;
			height: 20px;

			font-size: 16px;

			overflow: hidden;
			border: 2px solid #75544b;
			border-radius: 4px;
		}
		.searchResultText {
			/*font-weight: bold;*/
		}
		.searchResultTranslationText {
			margin-left: 20px;
		}
		#noResultsText {
			color: #75544b;

			box-sizing: border-box;
			display: inline-block;
			position: relative;
			margin: 10px;
			left: 50%;
			transform: translate(-50%, 0%);

			font-size: 20px;
			/*font-style: italic;*/
		}
		.searchResultAudioIcon {
			width:20px;
			height:20px;
			float:right;
			
			background: url('source/audio.png');
			background-size: contain;
		}
		.searchResultImageIcon {
			width:20px;
			height:20px;
			float:right;
			
			background: url('source/image.png');
			background-size: contain;
		}

		/* left panel search history */
		#historyPanel {
			background-color: #ffffff;

			position: absolute;
			left: 23px;
			top: calc(8px + 30px - 1px);
			width: calc(25vw - 46px);

			border: 1px solid #bfa07e;
			
			z-index: 2;
		}
		.historyEntry {
			color: #75544b;
			background-color: #ffffff;
			font-size: 16px;

			padding-left: 10px;
		}
		.historyEntry:hover {
			color: #ffffff;
			background-color: #75544b;
		}

		/* right panel */
		#contentPanel {
			background-color: #f2e3d3;
			
			box-sizing: border-box;
			position: absolute;
			padding: 20px;
			top: 50px;
			left: 25%;
			width: 75%;
			height: calc(100% - 50px);

			border-left: 4px solid #4f3a09;

			overflow: scroll;
			-ms-overflow-style: none;  /* Hide scrollbar for IE and Edge */
			scrollbar-width: none;  /* Hide scrollbar for Firefox */
		}
		#contentPanel::-webkit-scrollbar { display: none; } /* Hide scrollbar for Chrome, Safari and Opera */

		/* right panel title bar */
		#entryTitle {
			color: #4f3a09;

			display: block;
			padding: 5px;
		}
		.entryTitleText {
			margin-right: 10px;
			font-size: 40px;
			font-weight: bold;
		}
		.entryCatgText {
			margin-right: 10px;
			font-size: 18px;
			font-style: italic;
		}
		.entryTranslationText {
			font-size: 30px;
		}

		/* right panel data */
		#entryData {
			color: #4f3a09;

			display: block;
			margin-top: 5px;
			/*height: 200px;*/
		}
		.dataRow {
			display: block;
			margin-left: 40px;
			padding: 5px;
			height: 30px;
		}
		.dataHeader {
			font-size: 20px;
			/*font-weight: bold;*/
			text-decoration: underline;
		}
		.formName {
			font-size: 20px;
			font-weight: bold;
		}
		.formWord {
			margin-left: 10px;
			font-size: 20px;
		}
		.soundFileIcon {
			cursor: pointer;
			
			/*background-color: #ffffff;*/
			background: url('source/audio.png');
			background-size: contain;

			display: inline-block;
			width: 30px;
			height: 30px;

			/*border: 1px solid #000000;*/
		}
		.soundFileName {
			display: inline-block;
			position: relative;
			margin-left: 10px;
			top: 5px;

			font-size: 20px;
			font-weight: bold;

			vertical-align: top;
		}
		.soundFileSpeaker {
			/*color: #bfa07e;*/

			display: inline-block;
			position: relative;
			margin-left: 10px;
			top: 7px;

			font-size: 16px;

			vertical-align: top;
		}

		/* right panel floating image */
		#imageBox {
			background-color: #bfa07e;
			background-size: 100%;

			box-sizing: border-box;
			display: inline-block;
			position: absolute;
			top: 80px;
			left: 100%;
			width: 200px;
			height: auto;

			overflow: hidden;
			border: 2px solid #75544b;
			border-radius: 4px;
			transform: translate(calc(-100% - 20px), 0%);
		}

		/* right panel example sentences */
		#entrySentences {
			color: #4f3a09;
			/*background-color: #bfa07e;*/
			background-color: #dbb78f;

			display: block;
			margin-top: 20px;
			padding: 2px 10px;

			border: 2px solid #75544b;
			border-radius: 4px;
		}
		.entrySentence {
			display: block;
			margin: 10px;
		}
		.entrySentenceText {
			font-size: 20px;
		}
		.entrySentenceTranslation {
			margin-left: 10px;
			font-size: 20px;
			font-style: italic;
		}

		/* right panel synonyms */
		#synonyms {
			color: #4f3a09;

			display: block;
			margin-top: 5px;
			padding: 2px;

			font-size: 16px;
		}
		.synonym {
			cursor: pointer;

			display: inline-block;
			margin-left: 10px;

			font-weight: bold;
			text-decoration: underline;
		}
	</style>
</head>

<body>

	<!-- create loading screen -->

	<!-- load dependencies -->
	<script type='text/javascript' src='script/dictionary.js'></script>
	<script type='text/javascript' src='data/en-ch-v9.js'></script>
	<script type='text/javascript' src='source/resources.js'></script>

	<script>

		// 1.5 hrs: connect/test auto-generated audio/image resource list; switch to new system of searching; detect relevant audio per-entry
		// 0.5 hrs: automate resource detection
		// 2.0 hrs: rebuild full entry display for v9
		// 1.5 hrs: finish full entry display, add content icons to search, fix alignment bugs and overlapping text
		// 0.5 hrs: host pdf dictionary and prevent auto-download
		// 2.5 hrs: add search history and clear search button; add misc gfx improvements
		// 1.5 hrs: impl lang toggle; minor fixes to search/history

		//// TODO ////
		// automatically determine form of each sentence
		// keep separate history for each lang
		
		// make mobile-friendly version

		/////////////////////////////////////////////////////////////////////

		//// ENV SETUP ////

		// debug
		let t1 = Date.now();
		// settings
		let langToggle = false;
		let searchSettings = {
			shiftDown: false,
			elem: undefined,
			HISTORY_MAX_LENGTH: 5,
			showHistory: false,
			history: []
		};
		let soundSettings = {
			player: document.createElement('audio'),
			speakerAbbreviations: ['H',           'J'         ],
			speakerNames:         ['Holly Wyatt', 'Jane Wyatt']
		};

		// build dictionary
		let dictionary = new Dictionary(primary_eng, secondary_chk);
		dictionary.loadData( parse_en_ch_v9(tsv_en_ch_v9) );

		/////////////////////////////////////////////////////////////////////

		//// CORE ////

		function capitalize (s) { s=s.toString().toLowerCase(); return (s[0]||'').toUpperCase()+s.substr(1); }

		function playSound (filename) {
			soundSettings.player.pause();
			soundSettings.player.src = 'source/' + filename;
			soundSettings.player.play();
		}
		function findResources (entry, resourceList) {
			let forms = [];
			entry.forEachPrimaryForm((synonyms,formNum) => {
				for (let synonym of synonyms)
					forms.push(synonym);
			});
			entry.forEachSecondaryForm((synonyms,formNum) => {
				for (let synonym of synonyms)
					forms.push(synonym);
			});
			//
			let resources = [];
			for (let filepath of resourceList) {
				const filename = filepath.split('/').pop().split('.')[0];
				const word = filename.split('_')[0];
				const author = filename.split('_')[1] || 'Unknown';
				for (let form of forms) {
					if (form == word) {
						resources.push([form,filepath,author]);
					}
				}
			}
			return resources;
		}
		
		function togglePrimary() {
			// save current word before toggling lang
			const currentWord = searchSettings.history[searchSettings.history.length-1];
			const currentEntry = dictionary.searchWord(currentWord);
			const wordTranslation = (!langToggle) ? currentEntry.getSecondaryForm(0)[0] : currentEntry.getPrimaryForm(0)[0];
			langToggle = dictionary.togglePrimary();
			// ui
			document.getElementById('pageTitle').innerHTML = (!langToggle) ? `English-Chukchansi Dictionary` : `Chukchansi-English Waayaw Hudaʔhiy'`;
			document.getElementById('pageTitle').style.fontSize = (!langToggle) ? '25px' : '20px';
			document.getElementById('langToggleTitle').innerHTML = (!langToggle) ? 'en-ch' : 'ch-en';
			document.getElementById('langToggleSwitch').style.left = (!langToggle) ? '1px' : '11px';
			// current entry
			displayEntry(contentPanel, wordTranslation);
			// history
			searchSettings.history = [wordTranslation];
			refreshHistory();
			// search
			searchSettings.elem.value = '';
			searchSettings.elem.placeholder = (!langToggle) ? 'Search...' : 'Yuhgo...';
			populateContainer(resultPanel);
			filterContainer(resultPanel, '');
			resultPanel.scroll(0,0);
			document.getElementById('searchBar').focus();
		}
		function clearSearch() {
			searchSettings.showHistory = false;
			refreshHistory();
			searchSettings.elem.value = '';
			filterContainer(resultPanel, '');
			resultPanel.scroll(0, 0);
			document.getElementById('searchBar').focus();
		}

		function keydown_search (e) {
			switch (e.keyCode) {
				case 27: // [Esc] to defocus search box
					e.preventDefault();
					searchSettings.elem.blur();
					searchSettings.suggestionsElem.style.display = 'none';
					console.log('defocused search');
					break;
				case 9: // prevent [Tab] from leaving search box
					e.preventDefault();
					console.log('blocked tab-out');
					break;
				case 13: // prevent [Enter] from trying to submit page
					e.preventDefault();
					break;
				case 16: // manually track [Shift] for [?] detection
					searchSettings.shiftDown = true;
					break;
				case 191: // change [?] to [ʔ]
					if (searchSettings.shiftDown) {
						e.preventDefault();
						searchSettings.elem.value += 'ʔ';
					}
					break;
			}
		}
		function keyup_search (e) {
			switch (e.keyCode) {
				case 16: // manually track [Shift] for [?] detection
					searchSettings.shiftDown = false;
					break;
			}
			// run fragment search on searchbar update
			filterContainer(resultPanel, searchSettings.elem.value);
		}

		/////////////////////////////////////////////////////////////////////

		//// DISPLAY ////

		const subscriptFind = new RegExp('_([0-9]*)', 'ig'); // global, case-insensitive
		const subscriptReplace = '<sub>$1</sub>';
		const trySubscript = (text='') => text.replaceAll(subscriptFind, subscriptReplace);

		function refreshHistory () {
			if (searchSettings.showHistory) {
				document.getElementById('searchHistoryArrow').classList.remove('arrowDown');
				document.getElementById('searchHistoryArrow').classList.add('arrowUp');
			} else {
				document.getElementById('searchHistoryArrow').classList.remove('arrowUp');
				document.getElementById('searchHistoryArrow').classList.add('arrowDown');
			}

			let elemStr = '';

			for (let i = searchSettings.history.length-1; i >= 0; i--) {
				const word = searchSettings.history[i];
				elemStr += '<div class="historyEntry" onclick="displayEntry(contentPanel,`'+word+'`);">' + trySubscript(word) + '</div>';
			}

			document.getElementById('historyPanel').innerHTML = elemStr;
			document.getElementById('historyPanel').style.display = searchSettings.showHistory ? 'initial' : 'none';
		}

		function entryHTML (entry, word) {
			// console.log(entry, word);

			const chkForm0 = entry.getSecondaryForm(0);
			const chkForm1 = entry.getSecondaryForm(1);
			const chkForms = chkForm1 ? (chkForm0[0]+', '+chkForm1[0]) : chkForm0[0];
			const engForm0 = entry._pForms[0].join(', ');

			const catg = entry.catg;

			let audioResources = findResources(entry, audio_en_ch);
			let imageResources = findResources(entry, image_en_ch);

			let elemStr = '';

			elemStr += '<div id="'+word+'" class="searchResult" onclick="displayEntry(document.getElementById(`contentPanel`), `'+word+'`);">';
				elemStr += '<p style="float:left;"><span class="searchResultText">';
					elemStr += trySubscript(word);
				elemStr += '</span></p>';
				if (audioResources.length > 0) elemStr += '<div class="searchResultAudioIcon"></div>';
				if (imageResources.length > 0) elemStr += '<div class="searchResultImageIcon"></div>';
			elemStr += '</div>';

			return elemStr;
		}

		function populateContainer (container) {
			const tPop = Date.now();

			let elemStr = '';
			dictionary.forEachSynonym((entry, word) => { elemStr += entryHTML(entry, word); });
			elemStr += '<p id="noResultsText" style="display:none">No results...</p>';
			container.innerHTML = elemStr;

			console.log('DOM elements generated in ' + (Date.now()-tPop) + 'ms.');
		}

		function filterContainer (container, fragment) {
			// console.log('Searching "'+fragment+'"');
			const searchFragFromStart = new RegExp('^'+fragment, 'i'); // case insensitive

			let numResults = 0;
			let results = [];

			dictionary.forEachSynonym((entry, word) => {
				const match = searchFragFromStart.test(word);
				const entryElem = document.getElementById(word);

				if (match) {numResults++; results.push(word);}

				// entryElem.style.backgroundColor = (match) ? '#ffffff' : '#ff0000';
				entryElem.style.display = (match) ? 'block' : 'none';
			});

			document.getElementById('noResultsText').style.display = numResults>0 ? 'none' : 'block';

			console.log('Searching "'+fragment+'": '+numResults + ' matches');
			console.log(results);
		}

		function displayEntry (container, word) {
			// record word to history
			searchSettings.history = searchSettings.history.filter(x => x != word);
			searchSettings.history.push(word);
			if (searchSettings.history.length > searchSettings.HISTORY_MAX_LENGTH) searchSettings.history.shift();
			searchSettings.showHistory = false;
			refreshHistory();

			// prep data
			const entry = dictionary.searchWord(word);
			console.log(entry);
			const synonymID = entry.primarySynonymID(word);

			const chkForm0 = entry.getSecondaryForm(0);
			const chkForm1 = entry.getSecondaryForm(1);
			const chkForms = chkForm1 ? (chkForm0[0]+', '+chkForm1[0]) : chkForm0[0];
			const engForm0 = entry._pForms[0].join(', ');

			const title 		= !langToggle	? word			: chkForms;
			const titleTrans	=  langToggle	? engForm0		: chkForms;
			const catg			= entry.catg;
			const extraForms	= [];
			const sentences		= [];
			const synonyms		= ( langToggle ? entry.getSecondaryForm(0) : entry.getPrimaryForm(0) ).filter(form => form != word);

			if (!langToggle) entry.forEachSecondaryForm( (synonyms,formNum) => {if (formNum > 1) extraForms.push([synonyms[0],formNum])} );
			entry.forEachSentence( (sent) => sentences.push({base:sent.base, trans:sent.trans}) );

			const audioResources = findResources(entry, audio_en_ch);
			const imageResources = findResources(entry, image_en_ch);
			for (let [form,file,author] of audioResources) console.log(word+' has audio resource for '+form+': '+file);
			for (let [form,file,author] of imageResources) console.log(word+' has image resource for '+form+': '+file);

			let elemStr = '';

			// title
			elemStr += '<div id="entryTitle">';
				elemStr += '<p>';
					elemStr += '<span class="entryTitleText">' + trySubscript(title) + '</span>';
					elemStr += '<span class="entryCatgText">' + catg + '</span>';
					elemStr += '<span class="entryTranslationText">' + trySubscript(titleTrans) + '</span>';
				elemStr += '</p>';
			elemStr += '</div>';
			elemStr += '<div id="entryData">';
				// extra forms
				if (extraForms.length > 0) {
					elemStr += '<span class="dataRow">';
						elemStr += '<span class="dataHeader">FORMS</span>';
					elemStr += '</span>';
				}
				for (let [synonym,formNum] of extraForms) {
					elemStr += '<span class="dataRow">';
						elemStr += '<span class="formName">' + capitalize(dictionary[langToggle?'_pLang':'_sLang'].formStr(catg,formNum)) + ':</span>';
						elemStr += '<span class="formWord">' + trySubscript(synonym) + '</span>';
					elemStr += '</span>';
				}
				// audio
				if (extraForms.length > 0 && audioResources.length > 0) {
					elemStr += '<br>';
				}
				if (audioResources.length > 0) {
					elemStr += '<span class="dataRow">';
						elemStr += '<span class="dataHeader">EXAMPLES</span>';
					elemStr += '</span>';
				}
				for (let [form,file,author] of audioResources) {
					const speakerName = soundSettings.speakerNames[ soundSettings.speakerAbbreviations.indexOf(author) ] || 'Unknown Speaker';
					elemStr += '<span class="dataRow">';
						elemStr += '<div class="soundFileIcon" onclick="playSound(`' + file + '`)"></div>';
						elemStr += '<span class="soundFileName">' + trySubscript(form) + '</span>';
						elemStr += '<span class="soundFileSpeaker">(Spoken by ' + speakerName + ')</span>';
					elemStr += '</span>';
				}
			elemStr += '</div>';
			// sentences
			elemStr += '<div id="entrySentences">';
				elemStr += '<p>';
					for (let sentence of sentences) {
						elemStr += '<span class="entrySentence">';
							// elemStr += '(' + capitalize(dictionary._sLang.formStr(entry.catg,formNum)) + ') ';
							elemStr += '<span class="entrySentenceText">' + trySubscript(sentence.base) + '</span>';
							elemStr += '<span class="entrySentenceTranslation">' + trySubscript(sentence.trans) + '</span>';
						elemStr += '</span>';
					}
					if (sentences.length == 0) {
						elemStr += '<span class="entrySentenceText">[[ no example sentences ]]</span>';
					}
				elemStr += '</p>';
			elemStr += '</div>';
			// synonyms
			if (synonyms.length > 0) {
				elemStr += '<div id="synonyms">';
					elemStr += 'Synonymous with:';
					for (let synonym of synonyms) {
						elemStr += '<span class="synonym" onclick="displayEntry(contentPanel, `' + synonym + '`)">' + trySubscript(synonym) + '</span>';
					}
				elemStr += '</div>';
			}
			// images
			if (imageResources.length > 0) {
				const [form,file,author] = imageResources[0];
				elemStr += '<div id="imageBox">';
					elemStr += '<img src="source/' + file + '" width="200" style="display:block;">'; // display:block to remove inline whitespacing
				elemStr += '</div>';
			}
			
			container.innerHTML = elemStr;
			
			// scroll to top, since we just clicked a new word
			container.scroll(0,0);
		}

		function init(dictionary) {
			// add containers
			let navBar = document.createElement('div');
				navBar.id = 'navBar';
				navBar.innerHTML = '<span id="pageTitle">English-Chukchansi Dictionary</span>';
			document.body.appendChild(navBar);
			let searchPanel = document.createElement('div');
				searchPanel.id = 'searchPanel';
			document.body.appendChild(searchPanel);
			let resultPanel = document.createElement('div');
				resultPanel.id = 'resultPanel';
			document.body.appendChild(resultPanel);
			let contentPanel = document.createElement('div');
				contentPanel.id = 'contentPanel';
			document.body.appendChild(contentPanel);
			// initialize blank search
			let search = document.createElement('input');
				search.setAttribute('type', 'text');
				search.id = 'searchBar';
				search.placeholder = 'Search...';
				search.value = '';
			searchPanel.appendChild(search);
			searchSettings.elem = search;
			populateContainer(resultPanel);
			// add buttons to search box
			let searchClearButton = document.createElement('div');
				searchClearButton.id = 'searchClearButton';
				searchClearButton.innerHTML = '<div class="searchClearCross" style="transform: translate(-50%, -50%) rotate(45deg)"></div>'
											+ '<div class="searchClearCross" style="transform: translate(-50%, -50%) rotate(-45deg)"></div>';
				searchClearButton.onclick = clearSearch;
			searchPanel.appendChild(searchClearButton);
			let searchHistoryButton = document.createElement('div');
				searchHistoryButton.id = 'searchHistoryButton';
				searchHistoryButton.innerHTML = '<div id="searchHistoryArrow" class="arrowDown"></div>';
				searchHistoryButton.onclick = () => {
					searchSettings.showHistory = !searchSettings.showHistory;
					refreshHistory();
				};
			searchPanel.appendChild(searchHistoryButton);
			// initialize empty history
			let history = document.createElement('div');
				history.id = 'historyPanel';
				history.style.display = 'none';
			searchPanel.appendChild(history);
			refreshHistory();
			// add language toggle
			let langToggleTab = document.createElement('div');
				langToggleTab.id = 'hangingTab';
			navBar.appendChild(langToggleTab);
			let langToggleTitle = document.createElement('span');
				langToggleTitle.id = 'langToggleTitle';
				langToggleTitle.innerHTML = 'en-ch';
			langToggleTab.appendChild(langToggleTitle);
			let langToggle = document.createElement('div');
				langToggle.id = 'langToggle';
				langToggle.onclick = togglePrimary;
			langToggleTab.appendChild(langToggle);
			let langToggleSwitch = document.createElement('div');
				langToggleSwitch.id = 'langToggleSwitch';
			langToggle.appendChild(langToggleSwitch);

			// activate controls and search logic
			search.addEventListener('keydown', keydown_search);
			search.addEventListener('keyup', keyup_search);
			// display initial entry
			displayEntry(contentPanel, 'blackberry');
		}

		/////////////////////////////////////////////////////////////////////

		//// INIT ////

		init(dictionary);
		console.log('Load time: ' + (Date.now() - t1) + ' ms');

		/////////////////////////////////////////////////////////////////////
	</script>

</body>

</html>